---
- name: show run
  raw: "show running-config"
  register: result
  changed_when: false

- name: Backup
  ansible.builtin.copy:
    content: "{{ result.stdout_lines |join('\n') }}"
    dest: "backups/{{ inventory_hostname }}.tmp"
  when: result is defined
  delegate_to: localhost

- name: clear config
  shell: sed '/\[K/d' "backups/{{ inventory_hostname }}.tmp" > "backups/{{ inventory_hostname }}.conf" && rm -f "backups/{{ inventory_hostname }}.tmp"
  delegate_to: localhost
  changed_when: false
  args:
    executable: /usr/bin/bash
